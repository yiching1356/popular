<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹ (å¯¦æ™‚æˆ°æ³)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root { --yiqing-blue: #1e3a8a; --yiqing-gold: #f59e0b; --bg-soft: #f1f5f9; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg-soft); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .vote-card { width: 100%; max-width: 600px; background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 25px; }
        h1 { color: var(--yiqing-blue); margin: 0; font-size: 26px; }
        .candidate-list { display: flex; flex-direction: column; gap: 15px; }
        .candidate-item { border: 2px solid #e2e8f0; padding: 15px; border-radius: 16px; transition: 0.3s; position: relative; }
        .candidate-item.is-leading { border-color: var(--yiqing-gold); background: #fffcf0; transform: scale(1.01); }
        .candidate-info { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        .name { font-weight: bold; font-size: 17px; }
        .progress-track { height: 14px; background: #f1f5f9; border-radius: 7px; overflow: hidden; margin-bottom: 12px; }
        .progress-fill { height: 100%; width: 0%; background: #94a3b8; transition: width 1s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
        .leader-fill { background: linear-gradient(90deg, #f59e0b, #fbbf24); box-shadow: 0 0 10px rgba(245,158,11,0.3); }
        .vote-btn { width: 100%; padding: 12px; border: none; border-radius: 10px; background: var(--yiqing-blue); color: white; font-weight: bold; cursor: pointer; font-size: 16px; }
        .vote-btn:disabled { background: #cbd5e1; cursor: not-allowed; }
        .footer { text-align: center; margin-top: 25px; color: #94a3b8; font-size: 14px; }
        .alert-voted { color: #ef4444; background: #fee2e2; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<div id="app" class="vote-card">
    <div class="header">
        <h1>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹</h1>
        <p style="color: #64748b;">å¯¦æ™‚æˆ°æ³ï¼šæ¯ä¸€ç§’éƒ½åœ¨è®Šå‹•ï¼</p>
    </div>

    <div v-if="hasVoted" class="alert-voted">æ‚¨ä»Šå¤©å·²å®ŒæˆæŠ•ç¥¨ï¼Œæ„Ÿè¬åƒèˆ‡ï¼</div>

    <div class="candidate-list">
        <div v-for="(votes, name) in players" :key="name" class="candidate-item" :class="{'is-leading': isLeader(votes)}">
            <div class="candidate-info">
                <span class="name">
                    <span v-if="isLeader(votes)">ğŸ‘‘ </span>{{ name }}
                </span>
                <span style="font-weight: 800; color: #1e3a8a;">{{ votes }} ç¥¨ <small>({{ getPercent(votes) }}%)</small></span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" :class="{'leader-fill': isLeader(votes)}" :style="{ width: getPercent(votes) + '%' }"></div>
            </div>
            <button class="vote-btn" :disabled="hasVoted" @click="handleVote(name)">
                {{ hasVoted ? 'å·²è¨˜éŒ„æŠ•ç¥¨' : 'æŠ•çµ¦æ­¤å–®ä½' }}
            </button>
        </div>
    </div>
    <div class="footer">
        é›²ç«¯å³æ™‚åŒæ­¥ä¸­ | ç¸½æ”¶ç¥¨æ•¸ï¼š{{ totalVotes }}
    </div>
</div>

<script>
    // ä½ çš„å°ˆå±¬ Firebase é…ç½®
    const firebaseConfig = {
        apiKey: "AIzaSyBof1GHVYDUHqcsNQWW7grVNNxT_mt8sqA",
        authDomain: "yiqing-vote.firebaseapp.com",
        databaseURL: "https://yiqing-vote-default-rtdb.firebaseio.com",
        projectId: "yiqing-vote",
        storageBucket: "yiqing-vote.firebasestorage.app",
        messagingSenderId: "717925770555",
        appId: "1:717925770555:web:a2554db9a8e2ffe110031e",
        measurementId: "G-TSEDT2MYHK"
    };

    // åˆå§‹åŒ– Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const votesRef = db.ref('yiqing_2026_votes');

    const { createApp } = Vue;
    createApp({
        data() {
            return {
                hasVoted: localStorage.getItem('voted_yiqing_2026'),
                players: {
                    'è¯å¹³æ‰€ âœ¦ ç‘œèæ‰€é•·': 0,
                    'å®‰å¹³æ‰€ âœ¦ ç§€å¦‚æ‰€é•·': 0,
                    'å»ºè¨­éƒ¨': 0,
                    'ç¸½æ‰€ âœ¦ ç…’æ¾‚çµ„(K01)': 0,
                    'ç¸½æ‰€ âœ¦ ä½©å©·çµ„(P01)': 0,
                    'æ°¸åº·æ‰€ âœ¦ å­ç³æ‰€é•·': 0,
                    'æ©‹é ­æ‰€ âœ¦ æƒ å©·æ‰€é•·': 0,
                    'å–„åŒ–æ‰€ âœ¦ ææ•æ‰€é•·': 0,
                    'å˜‰ç¾©æ‰€ âœ¦ ç¾ä¼¶æ‰€é•·': 0
                }
            }
        },
        mounted() {
            // å³æ™‚åŒæ­¥é›²ç«¯æ•¸æ“š
            votesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // å°‡é›²ç«¯æ•¸æ“šåˆä½µåˆ°ç¾æœ‰åˆ—è¡¨
                    Object.keys(this.players).forEach(key => {
                        if (data[key] !== undefined) {
                            this.players[key] = data[key];
                        }
                    });
                }
            });
        },
        computed: {
            totalVotes() {
                return Object.values(this.players).reduce((a, b) => a + b, 0);
            },
            maxVote() {
                const vals = Object.values(this.players);
                return Math.max(...vals);
            }
        },
        methods: {
            getPercent(votes) {
                if (this.totalVotes === 0) return 0;
                return ((votes / this.totalVotes) * 100).toFixed(1);
            },
            isLeader(votes) {
                return votes === this.maxVote && votes > 0;
            },
            handleVote(name) {
                if (this.hasVoted) return;
                
                // åŸå­æ“ä½œï¼šç¢ºä¿å¤šäººåŒæ™‚é»æ“Šæ™‚ç¥¨æ•¸æ­£ç¢ºå¢åŠ 
                votesRef.child(name).transaction((currentVotes) => {
                    return (currentVotes || 0) + 1;
                });

                this.hasVoted = true;
                localStorage.setItem('voted_yiqing_2026', 'true');
            }
        }
    }).mount('#app');
</script>
</body>
</html>

</body>
</html>
