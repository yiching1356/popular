<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹çˆ­éœ¸æˆ°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --yiqing-main: #215440;
            --yiqing-gold: #c6a300;
            --yiqing-silver: #94a3b8;
            --yiqing-bronze: #b45309;
        }

        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: #f1f5f9; margin: 0; padding: 20px; color: #334155; }
        .vote-card { width: 100%; max-width: 550px; margin: 0 auto; background: white; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 10px solid var(--yiqing-main); }
        
        /* å€’æ•¸è¨ˆæ™‚å™¨æ¨£å¼ */
        .countdown-box { background: var(--yiqing-main); color: white; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .timer { font-family: monospace; font-size: 24px; font-weight: bold; color: #fbbf24; }

        .header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--yiqing-main); font-size: 28px; font-weight: 900; margin: 0; }
        .subtitle { font-size: 14px; color: #64748b; margin-top: 10px; line-height: 1.5; }

        .list-move { transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }

        .candidate-item { background: #fff; border: 2px solid #e2e8f0; padding: 15px; border-radius: 20px; margin-bottom: 12px; position: relative; transition: 0.3s; }
        .is-leading { border-color: var(--yiqing-gold); background: #fffdf5; box-shadow: 0 5px 15px rgba(198, 163, 0, 0.2); }

        /* æ¿€å‹µæ–‡å­—æ¨£å¼ */
        .motivational-text { font-size: 12px; font-weight: bold; padding: 4px 10px; border-radius: 20px; display: inline-block; margin-bottom: 5px; }
        .gold-tag { background: var(--yiqing-gold); color: white; }
        .silver-tag { background: #e2e8f0; color: #475569; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .info-row { display: flex; justify-content: space-between; align-items: center; }
        .name { font-weight: bold; font-size: 17px; color: var(--yiqing-main); }
        .vote-stats { font-weight: 900; color: var(--yiqing-main); }

        .progress-track { height: 10px; background: #f1f5f9; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: var(--yiqing-main); transition: width 1s ease; opacity: 0.5; }
        .leader-fill { background: var(--yiqing-gold); opacity: 1; }

        .vote-btn { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-ready { background: var(--yiqing-main); color: white; }
        .btn-voted-target { background: #dcfce7; color: #166534; }
        .btn-unvoted { background: #f1f5f9; color: #94a3b8; }
        .btn-disabled { background: #cbd5e1; color: white; cursor: not-allowed; }

        .footer { text-align: center; font-size: 12px; color: #94a3b8; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app" class="vote-card">
    <div class="countdown-box">
        <div style="font-size: 14px; margin-bottom: 5px;">â³ è·é›¢æŠ•ç¥¨æˆªæ­¢é‚„æœ‰</div>
        <div class="timer">{{ countdownText }}</div>
    </div>

    <div class="header">
        <h1>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹</h1>
        <div class="subtitle">
            è¬è¬å¤§å®¶é€™ä¸€å¹´ä¾†çš„æ”¯æŒï¼æ­¡è¿æŠ•ä¸‹å–œæ­¡çš„ä»£æ›¸ï¼Œ<br>
            ç‚ºä»–å€‘åœ¨ <strong>æ„Ÿæ©é¤æœƒ</strong> çˆ­å–æœ€é«˜æ¦®è€€ï¼
        </div>
    </div>

    <transition-group name="list" tag="div">
        <div v-for="(p, index) in sortedPlayers" :key="p.name" class="candidate-item" :class="{'is-leading': index === 0 && p.votes > 0}">
            
            <div v-if="p.votes > 0">
                <span v-if="index === 0" class="motivational-text gold-tag">ğŸ”¥ ç›®å‰é ˜å…ˆï¼</span>
                <span v-else-if="index === 1 || index === 2" class="motivational-text silver-tag">âš¡ åŠ æ²¹ï¼å¿«è¿½ä¸Šäº†ï¼</span>
                <span v-else class="motivational-text" style="color:#94a3b8">ğŸ“¢ å·®ä½ é€™ä¸€ç¥¨ï¼</span>
            </div>

            <div class="info-row">
                <span class="name">{{ index + 1 }}. {{ p.name }}</span>
                <span class="vote-stats">{{ p.votes }} ç¥¨</span>
            </div>
            
            <div class="progress-track">
                <div class="progress-fill" :class="{'leader-fill': index === 0}" :style="{ width: getPercent(p.votes) + '%' }"></div>
            </div>
            
            <template v-if="!isExpired">
                <button v-if="!hasVoted" class="vote-btn btn-ready" @click="handleVote(p.name)">ğŸ‘ è«‹æŠ•æˆ‘ä¸€ç¥¨ï¼</button>
                <button v-else-if="votedTarget === p.name" class="vote-btn btn-voted-target">ğŸ’– æ„Ÿè¬æ”¯æŒï¼</button>
                <button v-else class="vote-btn btn-unvoted">å—šå—šå—š ğŸ˜­</button>
            </template>
            <button v-else class="vote-btn btn-disabled">æ´»å‹•å·²æˆªæ­¢</button>
        </div>
    </transition-group>

    <div class="footer">
        å¯¦æ™‚é›²ç«¯åŒæ­¥ | ç›®å‰ç¸½ç¥¨æ•¸ï¼š{{ totalVotes }}
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBof1GHVYDUHqcsNQWW7grVNNxT_mt8sqA",
        authDomain: "yiqing-vote.firebaseapp.com",
        databaseURL: "https://yiqing-vote-default-rtdb.firebaseio.com",
        projectId: "yiqing-vote",
        storageBucket: "yiqing-vote.firebasestorage.app",
        messagingSenderId: "717925770555",
        appId: "1:717925770555:web:a2554db9a8e2ffe110031e",
        measurementId: "G-TSEDT2MYHK"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const votesRef = db.ref('yiqing_2026_votes');

    const { createApp } = Vue;
    createApp({
        data() {
            return {
                hasVoted: !!localStorage.getItem('voted_yiqing_2026'),
                votedTarget: localStorage.getItem('voted_target_name'),
                playersData: {
                    'æ°¸åº·æ‰€ âœ¦ å­ç³æ‰€é•·': 0, 'è¯å¹³æ‰€ âœ¦ ç‘œèæ‰€é•·': 0, 'å®‰å¹³æ‰€ âœ¦ ç§€å¦‚æ‰€é•·': 0,
                    'å–„åŒ–æ‰€ âœ¦ ææ•æ‰€é•·': 0, 'æ©‹é ­æ‰€ âœ¦ æƒ å©·æ‰€é•·': 0, 'ç¸½æ‰€ âœ¦ ç…’æ¾‚çµ„': 0,
                    'ç¸½æ‰€ âœ¦ ä½©å©·çµ„': 0, 'å˜‰ç¾©æ‰€ âœ¦ ç¾ä¼¶æ‰€é•·': 0, 'å»ºè¨­éƒ¨': 0
                },
                endTime: new Date("2026/02/11 17:30:00").getTime(),
                countdownText: "",
                isExpired: false
            }
        },
        mounted() {
            votesRef.on('value', (s) => {
                const data = s.val();
                if (data) Object.keys(this.playersData).forEach(k => { if(data[k]) this.playersData[k] = data[k] });
            });
            this.updateTimer();
            setInterval(this.updateTimer, 1000);
        },
        computed: {
            sortedPlayers() {
                return Object.keys(this.playersData).map(n => ({ name: n, votes: this.playersData[n] }))
                    .sort((a, b) => b.votes - a.votes);
            },
            totalVotes() { return Object.values(this.playersData).reduce((a, b) => a + b, 0); }
        },
        methods: {
            getPercent(v) { return this.totalVotes === 0 ? 0 : ((v / this.totalVotes) * 100).toFixed(1); },
            updateTimer() {
                const now = new Date().getTime();
                const diff = this.endTime - now;
                if (diff <= 0) {
                    this.countdownText = "æŠ•ç¥¨å·²æˆªæ­¢";
                    this.isExpired = true;
                    return;
                }
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                this.countdownText = `${d}å¤© ${h}æ™‚ ${m}åˆ† ${s}ç§’`;
            },
            handleVote(name) {
                if (this.hasVoted || this.isExpired) return;
                votesRef.child(name).transaction(v => (v || 0) + 1);
                this.hasVoted = true;
                this.votedTarget = name;
                localStorage.setItem('voted_yiqing_2026', 'true');
                localStorage.setItem('voted_target_name', name);
            }
        }
    }).mount('#app');
</script>
</body>
</html>
