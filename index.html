<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹çˆ­éœ¸æˆ°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --yiqing-main: #215440; /* ä½ æŒ‡å®šçš„æ·±ç¶ è‰² */
            --yiqing-gold: #c6a300;
            --bg-color: #f4f7f6;
        }

        body { 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            background: var(--bg-color); 
            margin: 0; padding: 20px; color: #334155;
        }
        
        .vote-card { 
            width: 100%; max-width: 550px; margin: 0 auto;
            background: white; padding: 30px; border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.08); 
            border-top: 8px solid var(--yiqing-main);
        }
        
        .header { text-align: center; margin-bottom: 25px; }
        h1 { color: var(--yiqing-main); font-size: 26px; font-weight: 900; margin: 0; letter-spacing: 1px; }
        .subtitle { 
            color: #4b5563; font-size: 15px; margin-top: 12px; 
            line-height: 1.6; font-weight: 500;
            background: #f1f5f9; padding: 15px; border-radius: 12px;
        }

        /* æ’åè®Šå‹•å¹³æ»‘å‹•ç•« */
        .list-move { transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }

        .candidate-item { 
            background: #ffffff; border: 1px solid #e2e8f0; padding: 18px; 
            border-radius: 15px; margin-bottom: 12px;
            transition: all 0.3s ease; position: relative;
        }
        
        /* é ˜å…ˆè€…ç‰¹æ•ˆ */
        .is-leading { 
            border: 2px solid var(--yiqing-gold); 
            background: #fdfdf2;
            transform: scale(1.02);
        }

        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .name { font-weight: bold; font-size: 18px; color: var(--yiqing-main); }
        .vote-stats { font-weight: 900; color: var(--yiqing-gold); font-size: 22px; }

        .progress-track { height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden; margin-bottom: 15px; }
        .progress-fill { 
            height: 100%; width: 0%; background: var(--yiqing-main); opacity: 0.6;
            transition: width 1s ease-in-out; 
        }
        .leader-fill { 
            background: var(--yiqing-gold); opacity: 1;
            box-shadow: 0 0 8px rgba(198, 163, 0, 0.4);
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .vote-btn { 
            width: 100%; padding: 12px; border: none; border-radius: 10px;
            font-weight: bold; font-size: 15px; cursor: pointer; transition: 0.2s;
        }
        
        .btn-ready { background: var(--yiqing-main); color: white; }
        .btn-ready:hover { opacity: 0.9; transform: translateY(-2px); }

        .btn-voted-target { background: #dcfce7; color: #166534; cursor: default; }
        .btn-unvoted { background: #f8fafc; color: #94a3b8; border: 1px solid #e2e8f0; cursor: default; }

        .footer { text-align: center; font-size: 13px; color: #94a3b8; margin-top: 25px; }
    </style>
</head>
<body>

<div id="app" class="vote-card">
    <div class="header">
        <h1>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹</h1>
        <div class="subtitle">
            è¬è¬å¤§å®¶é€™ä¸€å¹´ä¾†çš„æ”¯æŒï¼<br>
            æ­¡è¿æŠ•ä¸‹å–œæ­¡çš„ä»£æ›¸ï¼Œç‚ºä»–å€‘åœ¨<br>
            <strong>âœ¨ æ„Ÿæ©é¤æœƒ âœ¨</strong> çˆ­å–æœ€é«˜æ¦®è€€ï¼
        </div>
    </div>

    <transition-group name="list" tag="div" class="candidate-list">
        <div v-for="p in sortedPlayers" :key="p.name" class="candidate-item" :class="{'is-leading': isLeader(p.votes)}">
            <div class="info-row">
                <span class="name">
                    <span v-if="isLeader(p.votes)">ğŸ¥‡ </span>{{ p.name }}
                </span>
                <span class="vote-stats">{{ p.votes }} <small style="font-size: 12px; color:#94a3b8;">ç¥¨</small></span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" :class="{'leader-fill': isLeader(p.votes)}" :style="{ width: getPercent(p.votes) + '%' }"></div>
            </div>
            
            <button v-if="!hasVoted" class="vote-btn btn-ready" @click="handleVote(p.name)">
                ğŸ‘ è«‹æ”¯æŒæˆ‘ï¼ŒæŠ•æˆ‘ä¸€ç¥¨ï¼
            </button>
            <button v-else-if="votedTarget === p.name" class="vote-btn btn-voted-target">
                ğŸ’– æ„Ÿè¬æ‚¨çš„æ”¯æŒï¼
            </button>
            <button v-else class="vote-btn btn-unvoted">
                å—šå—šå—š ğŸ˜­
            </button>
        </div>
    </transition-group>

    <div class="footer">
        å¯¦æ™‚é›²ç«¯åŒæ­¥ä¸­ | ç›®å‰ç¸½ç¥¨æ•¸ï¼š{{ totalVotes }}
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBof1GHVYDUHqcsNQWW7grVNNxT_mt8sqA",
        authDomain: "yiqing-vote.firebaseapp.com",
        databaseURL: "https://yiqing-vote-default-rtdb.firebaseio.com",
        projectId: "yiqing-vote",
        storageBucket: "yiqing-vote.firebasestorage.app",
        messagingSenderId: "717925770555",
        appId: "1:717925770555:web:a2554db9a8e2ffe110031e",
        measurementId: "G-TSEDT2MYHK"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const votesRef = db.ref('yiqing_2026_votes');

    const { createApp } = Vue;
    createApp({
        data() {
            return {
                hasVoted: !!localStorage.getItem('voted_yiqing_2026'),
                votedTarget: localStorage.getItem('voted_target_name'),
                playersData: {
                    'æ°¸åº·æ‰€ âœ¦ å­ç³æ‰€é•·': 0,
                    'è¯å¹³æ‰€ âœ¦ ç‘œèæ‰€é•·': 0,
                    'å®‰å¹³æ‰€ âœ¦ ç§€å¦‚æ‰€é•·': 0,
                    'å–„åŒ–æ‰€ âœ¦ ææ•æ‰€é•·': 0,
                    'æ©‹é ­æ‰€ âœ¦ æƒ å©·æ‰€é•·': 0,
                    'ç¸½æ‰€ âœ¦ ç…’æ¾‚çµ„': 0,
                    'ç¸½æ‰€ âœ¦ ä½©å©·çµ„': 0,
                    'å˜‰ç¾©æ‰€ âœ¦ ç¾ä¼¶æ‰€é•·': 0,
                    'å»ºè¨­éƒ¨': 0
                }
            }
        },
        mounted() {
            votesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    Object.keys(this.playersData).forEach(key => {
                        if (data[key] !== undefined) this.playersData[key] = data[key];
                    });
                }
            });
        },
        computed: {
            sortedPlayers() {
                return Object.keys(this.playersData)
                    .map(name => ({ name, votes: this.playersData[name] }))
                    .sort((a, b) => b.votes - a.votes);
            },
            totalVotes() {
                return Object.values(this.playersData).reduce((a, b) => a + b, 0);
            },
            maxVote() {
                return Math.max(...Object.values(this.playersData));
            }
        },
        methods: {
            getPercent(votes) {
                if (this.totalVotes === 0) return 0;
                return ((votes / this.totalVotes) * 100).toFixed(1);
            },
            isLeader(votes) {
                return votes === this.maxVote && votes > 0;
            },
            handleVote(name) {
                if (this.hasVoted) return;
                votesRef.child(name).transaction((cv) => (cv || 0) + 1);
                this.hasVoted = true;
                this.votedTarget = name;
                localStorage.setItem('voted_yiqing_2026', 'true');
                localStorage.setItem('voted_target_name', name);
            }
        }
    }).mount('#app');
</script>
</body>
</html>
