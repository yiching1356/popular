<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹çˆ­éœ¸æˆ°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --yiqing-blue: #2563eb;
            --yiqing-gold: #f59e0b;
            --bg-color: #f8fafc;
        }

        body { 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            background: var(--bg-color); 
            margin: 0; padding: 20px; color: #1e293b;
        }
        
        .vote-card { 
            width: 100%; max-width: 550px; margin: 0 auto;
            background: white; padding: 25px; border-radius: 30px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.05); 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--yiqing-blue); font-size: 28px; font-weight: 900; margin: 0; }
        .subtitle { color: #64748b; font-size: 14px; margin-top: 5px; font-weight: bold; }

        /* åˆ—è¡¨ä½ç§»å‹•ç•«ï¼šæ’åè·³å‹•çš„æ ¸å¿ƒ */
        .list-move { transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }

        .candidate-item { 
            background: #ffffff; border: 2px solid #f1f5f9; padding: 18px; 
            border-radius: 20px; margin-bottom: 15px;
            transition: all 0.3s ease; position: relative;
        }
        
        /* é ˜å…ˆè€…å¤–æ¡†ç™¼å…‰ */
        .is-leading { 
            border: 2px solid var(--yiqing-gold); 
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.15);
            background: #fffdf5;
        }

        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .name { font-weight: bold; font-size: 17px; color: #334155; }
        .vote-stats { font-weight: 900; color: var(--yiqing-blue); font-size: 20px; }

        .progress-track { height: 12px; background: #f1f5f9; border-radius: 6px; overflow: hidden; margin-bottom: 12px; }
        .progress-fill { 
            height: 100%; width: 0%; background: #cbd5e1; border-radius: 6px; 
            transition: width 1s cubic-bezier(0.1, 0.7, 1.0, 0.1); 
        }
        .leader-fill { 
            background: linear-gradient(90deg, #f59e0b, #fbbf24); 
            box-shadow: 0 0 10px rgba(245,158,11,0.2);
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .vote-btn { 
            width: 100%; padding: 12px; border: none; border-radius: 12px;
            font-weight: bold; font-size: 16px; cursor: pointer; transition: all 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        
        /* å°šæœªæŠ•ç¥¨çš„æ¨£å¼ */
        .btn-ready { background: #eff6ff; color: var(--yiqing-blue); border: 1px solid #dbeafe; }
        .btn-ready:hover { background: var(--yiqing-blue); color: white; transform: scale(1.02); }

        /* æŠ•çµ¦ä»–å¾Œçš„æ¨£å¼ */
        .btn-voted-target { background: #dcfce7; color: #166534; cursor: default; }
        
        /* æ²’è¢«é¸ä¸­çš„æ¨£å¼ */
        .btn-unvoted { background: #f1f5f9; color: #94a3b8; cursor: default; }

        .total-info { text-align: center; font-size: 13px; color: #94a3b8; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app" class="vote-card">
    <div class="header">
        <h1>ğŸ† å®œæ…¶åœ°æ”¿äººæ°£ç‹</h1>
        <div class="subtitle">å¯¦æ™‚æ•¸æ“šé€£ç·šä¸­</div>
    </div>

    <transition-group name="list" tag="div" class="candidate-list">
        <div v-for="p in sortedPlayers" :key="p.name" class="candidate-item" :class="{'is-leading': isLeader(p.votes)}">
            <div class="info-row">
                <span class="name">
                    <span v-if="isLeader(p.votes)">ğŸ¥‡ </span>{{ p.name }}
                </span>
                <span class="vote-stats">{{ p.votes }} <small style="font-size: 12px;">ç¥¨</small></span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" :class="{'leader-fill': isLeader(p.votes)}" :style="{ width: getPercent(p.votes) + '%' }"></div>
            </div>
            
            <button v-if="!hasVoted" class="vote-btn btn-ready" @click="handleVote(p.name)">
                âœ¨ è«‹æŠ•æˆ‘ä¸€ç¥¨ï¼Œæ”¯æŒæˆ‘ï¼
            </button>
            <button v-else-if="votedTarget === p.name" class="vote-btn btn-voted-target">
                ğŸ’– æ„Ÿè¬æ”¯æŒï¼
            </button>
            <button v-else class="vote-btn btn-unvoted">
                å—šå—šå—š ğŸ˜­
            </button>
        </div>
    </transition-group>

    <div class="total-info">
        ç›®å‰å…¨é«”ç´¯ç©å·²æ”¶ç¥¨ï¼š{{ totalVotes }} ç¥¨
    </div>
</div>

<script>
    // Firebase é…ç½® (å·²å¥—ç”¨ä½ çš„é‡‘é‘°)
    const firebaseConfig = {
        apiKey: "AIzaSyBof1GHVYDUHqcsNQWW7grVNNxT_mt8sqA",
        authDomain: "yiqing-vote.firebaseapp.com",
        databaseURL: "https://yiqing-vote-default-rtdb.firebaseio.com",
        projectId: "yiqing-vote",
        storageBucket: "yiqing-vote.firebasestorage.app",
        messagingSenderId: "717925770555",
        appId: "1:717925770555:web:a2554db9a8e2ffe110031e",
        measurementId: "G-TSEDT2MYHK"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const votesRef = db.ref('yiqing_2026_votes');

    const { createApp } = Vue;
    createApp({
        data() {
            return {
                hasVoted: !!localStorage.getItem('voted_yiqing_2026'),
                votedTarget: localStorage.getItem('voted_target_name'),
                playersData: {
                    'æ°¸åº·æ‰€ âœ¦ å­ç³æ‰€é•·': 0,
                    'è¯å¹³æ‰€ âœ¦ ç‘œèæ‰€é•·': 0,
                    'å®‰å¹³æ‰€ âœ¦ ç§€å¦‚æ‰€é•·': 0,
                    'å–„åŒ–æ‰€ âœ¦ ææ•æ‰€é•·': 0,
                    'æ©‹é ­æ‰€ âœ¦ æƒ å©·æ‰€é•·': 0,
                    'ç¸½æ‰€ âœ¦ ç…’æ¾‚çµ„': 0,
                    'ç¸½æ‰€ âœ¦ ä½©å©·çµ„': 0,
                    'å˜‰ç¾©æ‰€ âœ¦ ç¾ä¼¶æ‰€é•·': 0,
                    'å»ºè¨­éƒ¨': 0
                }
            }
        },
        mounted() {
            votesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    Object.keys(this.playersData).forEach(key => {
                        if (data[key] !== undefined) this.playersData[key] = data[key];
                    });
                }
            });
        },
        computed: {
            sortedPlayers() {
                // å°‡å°è±¡è½‰ç‚ºé™£åˆ—ä¸¦æŒ‰ç¥¨æ•¸æ’åº
                return Object.keys(this.playersData)
                    .map(name => ({ name, votes: this.playersData[name] }))
                    .sort((a, b) => b.votes - a.votes);
            },
            totalVotes() {
                return Object.values(this.playersData).reduce((a, b) => a + b, 0);
            },
            maxVote() {
                return Math.max(...Object.values(this.playersData));
            }
        },
        methods: {
            getPercent(votes) {
                if (this.totalVotes === 0) return 0;
                return ((votes / this.totalVotes) * 100).toFixed(1);
            },
            isLeader(votes) {
                return votes === this.maxVote && votes > 0;
            },
            handleVote(name) {
                if (this.hasVoted) return;

                // æ›´æ–°é›²ç«¯è³‡æ–™åº«
                votesRef.child(name).transaction((cv) => (cv || 0) + 1);

                // å„²å­˜æŠ•ç¥¨ç´€éŒ„
                this.hasVoted = true;
                this.votedTarget = name;
                localStorage.setItem('voted_yiqing_2026', 'true');
                localStorage.setItem('voted_target_name', name);
            }
        }
    }).mount('#app');
</script>
</body>
</html>
